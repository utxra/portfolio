> [!abstract] Resumen del Incidente 
> Durante el despliegue del servidor web, **me enfrent√©** a un fallo cr√≠tico: el servidor rechazaba las conexiones. Este documento detalla mi proceso desde detecte el fallo y lo arregl√©.

## üö© Incidente

Tras el despliegue inicial del rol de servidor web, **he detectado** que el servidor rechazaba las conexiones en el puerto 80, a pesar de que el servicio Nginx figuraba como activo y el firewall permit√≠a el tr√°fico entrante.

## üïµÔ∏è An√°lisis de Causa Ra√≠z (RCA)

Investigu√© la configuraci√≥n, **he identificado** que la aplicaci√≥n del principio de "Reducci√≥n de la Superficie de Ataque" fue incompleta. 
Al eliminar el sitio `default` de Nginx para mejorar la seguridad, el servicio se qued√≥ sin ninguna directiva `listen 80`. 
Nginx estaba funcionando, pero no ten√≠a instrucciones para aceptar peticiones en ning√∫n puerto espec√≠fico de la capa de aplicaci√≥n.

## üõ°Ô∏è Soluci√≥n Aplicada

Para resolver esto, **he dise√±ado e implementado** un sitio endurecido desde cero:
1. **He creado** una plantilla de la configuraci√≥n del servidor web (`roles/webserver/templates/hardened_site.conf.j2`) para que se aplique en el servidor Nginx y escuche expl√≠citamente en el puerto 80.

2. **He vinculado** este sitio con mis pol√≠ticas de seguridad globales (`security_hardening.conf`) mediante la directiva `include`.

```roles/webserver/templates/hardened_site.conf.j2
server {
    listen 80;
    server_name localhost;

    root /var/www/html;
    index index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    # Integraci√≥n con mis cabeceras de seguridad globales
    include /etc/nginx/conf.d/security_hardening.conf;
}
```

1. **He automatizado** la creaci√≥n de enlaces simb√≥licos en `sites-enabled`, siguiendo el est√°ndar de administraci√≥n de sistemas Linux para asegurar una configuraci√≥n limpia, modular y auditable.
```roles/webserver/tasks/main.yml
- name: "NGINX: Activar el sitio"
  file:
    src: /etc/nginx/sites-available/hardened_site
    dest: /etc/nginx/sites-enabled/hardened_site
    state: link
  notify: restart nginx
```
