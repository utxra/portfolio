## üõ°Ô∏è Incidente: Rechazo de Conexi√≥n por Permisos Inseguros (SSH)

### Descripci√≥n del Problema

Al intentar realizar el primer `ansible -m ping` desde el **Control Node** (WSL2) hacia el **Managed Node** (Vagrant VM), la tarea fall√≥ con el siguiente error cr√≠tico:

> `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@` `@ WARNING: UNPROTECTED PRIVATE KEY FILE! @` `@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@` `Permissions 0777 for 'private_key' are too open. This private key will be ignored.`

---
### An√°lisis de Causa Ra√≠z (RCA)

1. **Mecanismo de Seguridad de SSH:** El cliente OpenSSH est√° dise√±ado para ignorar llaves privadas que sean legibles por otros usuarios (permisos de grupo o globales). Esto evita que, en un sistema multiusuario, un atacante local pueda exfiltrar la identidad de otro usuario.

2. **Interoperabilidad WSL2/NTFS:** El archivo de identidad se encontraba originalmente en `/mnt/c/` (sistema de archivos Windows NTFS). Por defecto, WSL2 monta estos discos usando el driver `DrvFs`, asignando permisos `0777` (rwxrwxrwx) a todos los archivos para asegurar la compatibilidad, lo cual incumple los requisitos de seguridad de SSH.

---
### Resoluci√≥n Aplicada

Siguiendo el **Principio de Menor Privilegio**, se opt√≥ por migrar el secreto al sistema de archivos nativo de Linux para tener un control granular sobre los metadatos de seguridad:

1. **Migraci√≥n de Datos:** Se movi√≥ la llave privada del mount de Windows al volumen `ext4` del usuario en WSL2.
```Bash
    cp /mnt/c/Users/trxpu/.../private_key ~/.ssh/id_vagrant_portfolio
```
   
2. **Hardening de Permisos:** Se aplic√≥ una m√°scara de bits restrictiva.
```Bash
chmod 600 ~/.ssh/id_vagrant_portfolio
```
   - `6` (propietario): Lectura y escritura.
   - `0` (grupo): Sin acceso.
   - `0` (otros): Sin acceso.

---
### Validaci√≥n de Seguridad

Tras la correcci√≥n, el comando `ansible webservers -m ping` devolvi√≥ un estado de `SUCCESS`, confirmando que el motor de Ansible pudo cargar el secreto una vez que este cumpli√≥ con los est√°ndares de integridad y confidencialidad exigidos.

![[Pasted image 20260209163713.png]]